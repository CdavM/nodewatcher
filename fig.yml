db:
    image: kostko/postgis
    environment:
        PGSQL_SUPERUSER_USERNAME: nodewatcher
        PGSQL_SUPERUSER_PASSWORD: nodewatcher
    volumes:
        # Use a volume to enable database persistency across restarts
        - /tmp/nodewatcher-db:/var/lib/postgresql/9.3/main
tokumx:
    image: kostko/tokumx
    # A privileged container is required to disable hugepages for TokuMX
    privileged: true
generator:
    build: .
    command: celery worker -A nodewatcher -l info -Q generator --autoreload
    entrypoint: scripts/docker-run
    environment:
        # Allow celery to run under the root user in order for it to have access
        C_FORCE_ROOT: true
    volumes:
        - .:/code
    links:
        - db
        - tokumx
web:
    build: .
    command: python manage.py runserver 0.0.0.0:8000
    entrypoint: scripts/docker-run
    volumes:
        - .:/code
    ports:
        - "8000:8000"
    links:
        - db
        - tokumx
        - generator
